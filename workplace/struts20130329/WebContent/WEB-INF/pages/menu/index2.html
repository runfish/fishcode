<#include "/common/_layout.html"/>
<@layout >
<style>
.menustat0,.menustat1{background: url(dwz/img/imgX.gif) no-repeat;width:22px;height:20px;}
.menustat1{background-position: -98px;}
.menustat0{background-position: -28px;}

.span0{margin-left:0px;}
.span1{margin-left:20px;}
.span2{margin-left:40px;}
.span3{margin-left:60px;}
.span4{margin-left:80px;}
</style>
<div class="pageHeader">
		<form action="ht/menu" method="post" id="pagerForm"
			onsubmit="return navTabSearch(this)">
			<div class="searchBar">
				<ul class="searchContent">
					<li>
						<label>
							菜单类型
						</label>
						<select name="type" id="menu_type" val="${type!}">
							<option value="">全部</option>
						</select>
					</li>
					<li>
						<label>
							菜单名称
						</label>
						<input type="text" name="name" val="${name!}"/>
					</li>
				</ul>
				<@searchBar/>
			</div>
		</form>
	</div>
	<div class="pageContent">
		<div class="panelBar">
			<ul class="toolBar">
				<li><a class="add" href="/ht/menu/add" title="添加顶级菜单"
					target="dialog" height="200" width="600"><span>添加顶级菜单</span> </a></li>
				<li><a class="add" href="/ht/menu/child/{sid_key}" title="添加子菜单"
					target="dialog" height="200" width="600"><span>添加子菜单</span> </a></li>
				<li><a class="edit" href="/ht/menu/add/{sid_key}"
					title="修改菜单" target="dialog" height="200" width="600"><span>修改</span>
				</a></li>
				<li class="line">line</li>
				<li><a class="delete" href="/ht/menu/del/{sid_key}" title="确定要删除该菜单吗？" target="ajaxTodo"><span>删除</span> </a></li>
			</ul>
		</div>
		
		<table class="table" id="menu_table" width="800px"
	layouth="55">
	<thead>
		<tr>
			<th width="50px">序号</th> <#list collist as t>
			<th>${t!}</th> </#list>
		</tr>
	</thead>
	<tbody>
		<#list list as d>
		<tr target="sid_key" rel="${d.id!}">
			<td>${d_index+1}</td> <#list collist as t>
			<td>${d.get(t)!}</td> </#list>
		</tr>
		</#list>
	</tbody>
</table>
	</div>
	<script type="text/javascript">
var menuType=["导航栏","菜单","按钮"];
var sysparamType=["菜系","房台类型"];
$("#menu_table tr td:nth-child(2)").each(function(r,td){
	var num=(new Number($(td).text()));
	$(td).text(menuType[num]);
});
$("#menu_table tr td:nth-child(8)").each(function(r,td){
	var num=(new Number($(td).text()));
	$(td).html("<span class='menustat"+num+"'>&nbsp;&nbsp;&nbsp;&nbsp;</span>");
});

function down(){
	var $tr=$("tr.selected");
	if($tr==null||$tr=== undefined||$tr.length==0){
		alertMsg.error('请选择要移动的项');
		return ;
	}

	var $nexttr;
	//是需要找同一个级别的，而不是简单的下一个
	var level=$tr.children("td").eq(2).text(); //选择项 的级别
	var isfind=false;//是否在下面找到了同辈元素，
	$tr.nextAll().each(function(r,tr){
		var nextval=$(tr).children("td").eq(2).text();//遍历获得
		if(level==nextval){
			debugger;
			isfind=true;
			$nexttr=$(tr);
			return false;
		}
	});
	
	if(!isfind){
		alertMsg.error('下面没有找到同辈元素，不能向下移动');
		return ;
	}
	
	var id=$tr.attr("rel"); //选择项的值
	var nextid=$nexttr.attr("rel");
	
	var val=$tr.children("td").eq(4).text(); //排序的值
	var nextval=$nexttr.children("td").eq(4).text();
	
	var url="menu/move/"+id+"-"+val+"-"+nextid+"-"+nextval
	$.ajax({
		  url: url,
		  cache: false,
		  dataType :"json",
		  success: function(json){
			  navTabAjaxDone(json);
		  }
	});
}


function up(){
	var $tr=$("tr.selected");
	if($tr==null||$tr=== undefined||$tr.length==0){
		alertMsg.error('请选择要移动的项');
		return ;
	}

	var $nexttr;
	//是需要找同一个级别的，而不是简单的下一个
	var level=$tr.children("td").eq(2).text(); //选择项 的级别
	var isfind=false;//是否在下面找到了同辈元素，
	$tr.prevAll().each(function(r,tr){
		var nextval=$(tr).children("td").eq(2).text();//遍历获得
		if(level==nextval){
			isfind=true;
			$nexttr=$(tr);
			return false;
		}
	});
	
	if(!isfind){
		alertMsg.error('上面没有找到同辈元素，不能向上移动');
		return ;
	}
	
	var id=$tr.attr("rel"); //选择项的值
	var nextid=$nexttr.attr("rel");
	
	var val=$tr.children("td").eq(4).text(); //排序的值
	var nextval=$nexttr.children("td").eq(4).text();
	
	var url="menu/move/"+id+"-"+val+"-"+nextid+"-"+nextval
	$.ajax({
		  url: url,
		  cache: false,
		  dataType :"json",
		  success: function(json){
			  navTabAjaxDone(json);
		  }
	});
}

</script>
</@layout>